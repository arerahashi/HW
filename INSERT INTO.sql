USE HW_CashOrderService;
GO

-- 1) Справочники 

  INSERT INTO order_statuses(status_name) VALUES
  (N'Создан'),
  (N'Подтвержден'),
  (N'Готов к выдаче'),
  (N'Выдан'),
  (N'Отменен'),
  (N'Истек');

  INSERT INTO notification_channels(channel_name) VALUES
  (N'SMS'),
  (N'Email'),
  (N'Push');


-- 2) Отделения 

INSERT INTO branches(branch_code, address, phone, branch_status) VALUES
(N'BR-001', N'Москва, ул. Тверская, 10', N'+7 495 111-11-11', N'Открыто'),
(N'BR-002', N'Санкт-Петербург, Невский пр., 25', N'+7 812 222-22-22', N'Открыто'),
(N'BR-003', N'Казань, ул. Баумана, 5', N'+7 843 333-33-33', N'Открыто');


-- 3) Клиенты 

INSERT INTO clients(full_name, phone, document_number, address, created_at, client_status) VALUES
(N'Иванов Иван Иванович', N'+7 900 100-00-01', N'4500 111111', N'Москва, ул. Ленина, 1',  '2024-11-10T10:10:00', N'Активен'),
(N'Петров Пётр Петрович', N'+7 900 100-00-02', N'4500 222222', N'Москва, ул. Ленина, 2',  '2024-11-12T12:00:00', N'Активен'),
(N'Сидорова Анна Сергеевна', N'+7 900 100-00-03', N'4500 333333', N'Москва, ул. Ленина, 3', '2024-12-01T09:30:00', N'Активен'),
(N'Кузнецов Дмитрий Олегович', N'+7 900 100-00-04', N'4500 444444', N'Москва, ул. Мира, 10',  '2024-12-05T18:20:00', N'Активен'),
(N'Смирнова Елена Андреевна', N'+7 900 100-00-05', N'4500 555555', N'Москва, ул. Мира, 11', '2024-12-10T08:05:00', N'Активен'),
(N'Морозов Илья Павлович', N'+7 900 100-00-06', N'4500 666666', N'СПб, ул. Пушкина, 7',   '2024-12-15T14:40:00', N'Активен'),
(N'Волкова Мария Игоревна', N'+7 900 100-00-07', N'4500 777777', N'СПб, ул. Пушкина, 8',  '2024-12-18T16:10:00', N'Активен'),
(N'Фёдоров Артём Николаевич', N'+7 900 100-00-08', N'4500 888888', N'СПб, ул. Пушкина, 9', '2025-01-05T11:25:00', N'Активен'),
(N'Зайцева Полина Максимовна', N'+7 900 100-00-09', N'4500 999999', N'СПб, Невский пр., 1',  '2025-01-10T10:00:00', N'Активен'),
(N'Орлов Кирилл Денисович', N'+7 900 100-00-10', N'4510 101010', N'Казань, ул. Кремлёвская, 2', '2025-01-12T12:12:00', N'Активен'),
(N'Николаева Дарья Романовна', N'+7 900 100-00-11', N'4510 111111', N'Казань, ул. Кремлёвская, 3', '2025-01-15T09:45:00', N'Активен'),
(N'Громов Алексей Владимирович', N'+7 900 100-00-12', N'4510 121212', N'Казань, ул. Баумана, 12', '2025-01-18T19:00:00', N'Активен'),
(N'Крылова Софья Евгеньевна', N'+7 900 100-00-13', N'4510 131313', N'Казань, ул. Баумана, 13', '2025-02-01T08:00:00', N'Активен'),
(N'Белова Вероника Артёмовна', N'+7 900 100-00-14', N'4510 141414', N'Москва, ул. Садовая, 6', '2025-02-05T13:30:00', N'Активен'),
(N'Тихонов Максим Степанович', N'+7 900 100-00-15', N'4510 151515', N'СПб, Невский пр., 20',   '2025-02-10T17:10:00', N'Активен');


-- 4) Заказы

INSERT INTO cash_orders(client_id, branch_id, status_id, commission, created_at, finished_at, order_amount, currency) VALUES
(1, 1, 4, 100.00, '2025-01-12T10:00:00', '2025-01-13T15:00:00', 15000.00, N'RUB'),
(2, 1, 3,  80.00, '2025-02-05T12:20:00', NULL,                 20000.00, N'RUB'),
(3, 1, 2,  50.00, '2025-03-03T09:10:00', NULL,                 12000.00, N'RUB'),
(4, 1, 4, 120.00, '2025-04-18T16:45:00', '2025-04-19T11:00:00',30000.00, N'RUB'),
(5, 1, 1,   0.00, '2025-05-07T08:30:00', NULL,                  5000.00, N'RUB'),
(14,1, 4, 150.00, '2025-06-10T14:00:00', '2025-06-12T10:10:00',40000.00, N'RUB'),
(1, 1, 3,  60.00, '2025-07-22T18:05:00', NULL,                 18000.00, N'RUB'),
(3, 1, 2,  70.00, '2025-08-01T11:11:00', NULL,                 22000.00, N'RUB');

INSERT INTO cash_orders(client_id, branch_id, status_id, commission, created_at, finished_at, order_amount, currency) VALUES
(6, 2, 4,  90.00, '2025-01-20T13:00:00', '2025-01-21T10:00:00', 17000.00, N'RUB'),
(7, 2, 3,  60.00, '2025-02-14T09:40:00', NULL,                 11000.00, N'RUB'),
(8, 2, 2,  50.00, '2025-03-09T15:30:00', NULL,                 14000.00, N'RUB'),
(9, 2, 4, 130.00, '2025-04-02T10:15:00', '2025-04-03T16:00:00', 35000.00, N'RUB'),
(15,2, 1,   0.00, '2025-05-25T08:20:00', NULL,                  8000.00, N'RUB'),
(6, 2, 4, 110.00, '2025-06-11T12:12:00', '2025-06-12T09:00:00', 25000.00, N'RUB'),
(7, 2, 3,  75.00, '2025-07-07T17:50:00', NULL,                 21000.00, N'RUB'),
(8, 2, 2,  40.00, '2025-08-19T11:05:00', NULL,                  9000.00, N'RUB');

INSERT INTO cash_orders(client_id, branch_id, status_id, commission, created_at, finished_at, order_amount, currency) VALUES
(10,3, 4,  70.00, '2025-01-08T10:10:00', '2025-01-09T14:00:00', 16000.00, N'RUB'),
(11,3, 3,  55.00, '2025-02-21T09:00:00', NULL,                 13000.00, N'RUB'),
(12,3, 2,  45.00, '2025-03-15T16:30:00', NULL,                 10000.00, N'RUB'),
(13,3, 4, 125.00, '2025-04-27T12:00:00', '2025-04-28T10:00:00', 33000.00, N'RUB'),
(10,3, 1,   0.00, '2025-05-03T18:18:00', NULL,                  7000.00, N'RUB'),
(11,3, 4, 140.00, '2025-06-22T10:35:00', '2025-06-23T15:15:00', 38000.00, N'RUB'),
(12,3, 3,  65.00, '2025-07-30T09:09:00', NULL,                 19000.00, N'RUB'),
(13,3, 2,  50.00, '2025-08-05T13:13:00', NULL,                 15000.00, N'RUB');


-- 5) История статусов 

INSERT INTO order_status_history(order_id, status_id, status_date)
SELECT order_id, status_id, created_at
FROM cash_orders;


-- 6) Уведомления 

INSERT INTO notifications(order_id, channel_id, notification_text, created_at, is_sent)
SELECT
  o.order_id,
  CASE (o.order_id % 3)
    WHEN 1 THEN 1
    WHEN 2 THEN 2
    ELSE 3
  END AS channel_id,
  N'Уведомление по заказу №' + CAST(o.order_id AS NVARCHAR(20)) + N': статус "' +
    s.status_name + N'".' AS notification_text,
  DATEADD(MINUTE, 10, o.created_at) AS created_at,
  CAST(1 AS BIT) AS is_sent
FROM cash_orders o
JOIN order_statuses s ON s.status_id = o.status_id;
