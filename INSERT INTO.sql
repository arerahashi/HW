USE HW_CashOrderService;
GO
-- 1) Ñïðàâî÷íèêè 

  INSERT INTO order_statuses(status_name) VALUES
  (N'Ñîçäàí'),
  (N'Ïîäòâåðæäåí'),
  (N'Ãîòîâ ê âûäà÷å'),
  (N'Âûäàí'),
  (N'Îòìåíåí'),
  (N'Èñòåê');

  INSERT INTO notification_channels(channel_name) VALUES
  (N'SMS'),
  (N'Email'),
  (N'Push');


-- 2) Îòäåëåíèÿ 

INSERT INTO branches(branch_code, address, phone, branch_status) VALUES
(N'BR-001', N'Ìîñêâà, óë. Òâåðñêàÿ, 10', N'+7 495 111-11-11', N'Îòêðûòî'),
(N'BR-002', N'Ñàíêò-Ïåòåðáóðã, Íåâñêèé ïð., 25', N'+7 812 222-22-22', N'Îòêðûòî'),
(N'BR-003', N'Êàçàíü, óë. Áàóìàíà, 5', N'+7 843 333-33-33', N'Îòêðûòî');


-- 3) Êëèåíòû 

INSERT INTO clients(full_name, phone, document_number, address, created_at, client_status) VALUES
(N'Èâàíîâ Èâàí Èâàíîâè÷', N'+7 900 100-00-01', N'4500 111111', N'Ìîñêâà, óë. Ëåíèíà, 1',  '2024-11-10T10:10:00', N'Àêòèâåí'),
(N'Ïåòðîâ Ï¸òð Ïåòðîâè÷', N'+7 900 100-00-02', N'4500 222222', N'Ìîñêâà, óë. Ëåíèíà, 2',  '2024-11-12T12:00:00', N'Àêòèâåí'),
(N'Ñèäîðîâà Àííà Ñåðãååâíà', N'+7 900 100-00-03', N'4500 333333', N'Ìîñêâà, óë. Ëåíèíà, 3', '2024-12-01T09:30:00', N'Àêòèâåí'),
(N'Êóçíåöîâ Äìèòðèé Îëåãîâè÷', N'+7 900 100-00-04', N'4500 444444', N'Ìîñêâà, óë. Ìèðà, 10',  '2024-12-05T18:20:00', N'Àêòèâåí'),
(N'Ñìèðíîâà Åëåíà Àíäðååâíà', N'+7 900 100-00-05', N'4500 555555', N'Ìîñêâà, óë. Ìèðà, 11', '2024-12-10T08:05:00', N'Àêòèâåí'),
(N'Ìîðîçîâ Èëüÿ Ïàâëîâè÷', N'+7 900 100-00-06', N'4500 666666', N'ÑÏá, óë. Ïóøêèíà, 7',   '2024-12-15T14:40:00', N'Àêòèâåí'),
(N'Âîëêîâà Ìàðèÿ Èãîðåâíà', N'+7 900 100-00-07', N'4500 777777', N'ÑÏá, óë. Ïóøêèíà, 8',  '2024-12-18T16:10:00', N'Àêòèâåí'),
(N'Ô¸äîðîâ Àðò¸ì Íèêîëàåâè÷', N'+7 900 100-00-08', N'4500 888888', N'ÑÏá, óë. Ïóøêèíà, 9', '2025-01-05T11:25:00', N'Àêòèâåí'),
(N'Çàéöåâà Ïîëèíà Ìàêñèìîâíà', N'+7 900 100-00-09', N'4500 999999', N'ÑÏá, Íåâñêèé ïð., 1',  '2025-01-10T10:00:00', N'Àêòèâåí'),
(N'Îðëîâ Êèðèëë Äåíèñîâè÷', N'+7 900 100-00-10', N'4510 101010', N'Êàçàíü, óë. Êðåìë¸âñêàÿ, 2', '2025-01-12T12:12:00', N'Àêòèâåí'),
(N'Íèêîëàåâà Äàðüÿ Ðîìàíîâíà', N'+7 900 100-00-11', N'4510 111111', N'Êàçàíü, óë. Êðåìë¸âñêàÿ, 3', '2025-01-15T09:45:00', N'Àêòèâåí'),
(N'Ãðîìîâ Àëåêñåé Âëàäèìèðîâè÷', N'+7 900 100-00-12', N'4510 121212', N'Êàçàíü, óë. Áàóìàíà, 12', '2025-01-18T19:00:00', N'Àêòèâåí'),
(N'Êðûëîâà Ñîôüÿ Åâãåíüåâíà', N'+7 900 100-00-13', N'4510 131313', N'Êàçàíü, óë. Áàóìàíà, 13', '2025-02-01T08:00:00', N'Àêòèâåí'),
(N'Áåëîâà Âåðîíèêà Àðò¸ìîâíà', N'+7 900 100-00-14', N'4510 141414', N'Ìîñêâà, óë. Ñàäîâàÿ, 6', '2025-02-05T13:30:00', N'Àêòèâåí'),
(N'Òèõîíîâ Ìàêñèì Ñòåïàíîâè÷', N'+7 900 100-00-15', N'4510 151515', N'ÑÏá, Íåâñêèé ïð., 20',   '2025-02-10T17:10:00', N'Àêòèâåí');


-- 4) Çàêàçû

INSERT INTO cash_orders(client_id, branch_id, status_id, commission, created_at, finished_at, order_amount, currency) VALUES
(1, 1, 4, 100.00, '2025-01-12T10:00:00', '2025-01-13T15:00:00', 15000.00, N'RUB'),
(2, 1, 3,  80.00, '2025-02-05T12:20:00', NULL,                 20000.00, N'RUB'),
(3, 1, 2,  50.00, '2025-03-03T09:10:00', NULL,                 12000.00, N'RUB'),
(4, 1, 4, 120.00, '2025-04-18T16:45:00', '2025-04-19T11:00:00',30000.00, N'RUB'),
(5, 1, 1,   0.00, '2025-05-07T08:30:00', NULL,                  5000.00, N'RUB'),
(14,1, 4, 150.00, '2025-06-10T14:00:00', '2025-06-12T10:10:00',40000.00, N'RUB'),
(1, 1, 3,  60.00, '2025-07-22T18:05:00', NULL,                 18000.00, N'RUB'),
(3, 1, 2,  70.00, '2025-08-01T11:11:00', NULL,                 22000.00, N'RUB');

INSERT INTO cash_orders(client_id, branch_id, status_id, commission, created_at, finished_at, order_amount, currency) VALUES
(6, 2, 4,  90.00, '2025-01-20T13:00:00', '2025-01-21T10:00:00', 17000.00, N'RUB'),
(7, 2, 3,  60.00, '2025-02-14T09:40:00', NULL,                 11000.00, N'RUB'),
(8, 2, 2,  50.00, '2025-03-09T15:30:00', NULL,                 14000.00, N'RUB'),
(9, 2, 4, 130.00, '2025-04-02T10:15:00', '2025-04-03T16:00:00', 35000.00, N'RUB'),
(15,2, 1,   0.00, '2025-05-25T08:20:00', NULL,                  8000.00, N'RUB'),
(6, 2, 4, 110.00, '2025-06-11T12:12:00', '2025-06-12T09:00:00', 25000.00, N'RUB'),
(7, 2, 3,  75.00, '2025-07-07T17:50:00', NULL,                 21000.00, N'RUB'),
(8, 2, 2,  40.00, '2025-08-19T11:05:00', NULL,                  9000.00, N'RUB');

INSERT INTO cash_orders(client_id, branch_id, status_id, commission, created_at, finished_at, order_amount, currency) VALUES
(10,3, 4,  70.00, '2025-01-08T10:10:00', '2025-01-09T14:00:00', 16000.00, N'RUB'),
(11,3, 3,  55.00, '2025-02-21T09:00:00', NULL,                 13000.00, N'RUB'),
(12,3, 2,  45.00, '2025-03-15T16:30:00', NULL,                 10000.00, N'RUB'),
(13,3, 4, 125.00, '2025-04-27T12:00:00', '2025-04-28T10:00:00', 33000.00, N'RUB'),
(10,3, 1,   0.00, '2025-05-03T18:18:00', NULL,                  7000.00, N'RUB'),
(11,3, 4, 140.00, '2025-06-22T10:35:00', '2025-06-23T15:15:00', 38000.00, N'RUB'),
(12,3, 3,  65.00, '2025-07-30T09:09:00', NULL,                 19000.00, N'RUB'),
(13,3, 2,  50.00, '2025-08-05T13:13:00', NULL,                 15000.00, N'RUB');


-- 5) Èñòîðèÿ ñòàòóñîâ 

INSERT INTO order_status_history(order_id, status_id, status_date)
SELECT order_id, status_id, created_at
FROM cash_orders;


-- 6) Óâåäîìëåíèÿ 

INSERT INTO notifications(order_id, channel_id, notification_text, created_at, is_sent)
SELECT
  o.order_id,
  CASE (o.order_id % 3)
    WHEN 1 THEN 1
    WHEN 2 THEN 2
    ELSE 3
  END AS channel_id,
  N'Óâåäîìëåíèå ïî çàêàçó ¹' + CAST(o.order_id AS NVARCHAR(20)) + N': ñòàòóñ "' +
    s.status_name + N'".' AS notification_text,
  DATEADD(MINUTE, 10, o.created_at) AS created_at,
  CAST(1 AS BIT) AS is_sent
FROM cash_orders o
JOIN order_statuses s ON s.status_id = o.status_id;

